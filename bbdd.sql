CREATE DATABASE IF NOT EXISTS GreenSpaceFilms;

USE GreenSpaceFilms;

CREATE TABLE IF NOT EXISTS users (
	id INT PRIMARY KEY AUTO_INCREMENT,
	creationDateTime DATETIME NOT NULL DEFAULT NOW(),
	username VARCHAR(45) NOT NULL UNIQUE,
	password VARCHAR (80) NOT NULL,
	mail VARCHAR (60) NOT NULL UNIQUE,
	pfp BLOB NULL DEFAULT NULL,
	admin BOOL NOT NULL DEFAULT 0
);

CREATE TABLE IF NOT EXISTS films (
	id INT PRIMARY KEY AUTO_INCREMENT,
	name VARCHAR(60) NOT NULL UNIQUE,
	synopsis VARCHAR(1000) NOT NULL,
	cover BLOB NOT NULL,
	duration TIME NOT NULL,
	minAge INT NOT NULL,
	price DOUBLE NOT NULL,
	genres SET('Accion','Aventura','Misterio','Ciencia ficción','Drama','Fantasía','Terror','Suspense','Comedia') NOT NULL,
	premiering BOOL NOT NULL DEFAULT 0,
	next_premiering BOOL NOT NULL DEFAULT 0
);

CREATE TABLE IF NOT EXISTS rooms (
	id INT PRIMARY KEY AUTO_INCREMENT,
	type ENUM('Standard','Dolby','ISENSE') NOT NULL DEFAULT 'Standard'
);

CREATE TABLE IF NOT EXISTS sessions (
	id INT PRIMARY KEY AUTO_INCREMENT,
	filmId INT NOT NULL,
	roomId INT NOT NULL,
	startHour TIME NOT NULL,
	total_seats INT NOT NULL,
	occupied_seats INT NOT NULL DEFAULT 0,
	seats_status BLOB NOT NULL,
	FOREIGN KEY (filmId) REFERENCES films(id),
	FOREIGN KEY (roomId) REFERENCES rooms(id)
);

CREATE TABLE IF NOT EXISTS tickets (
	id INT PRIMARY KEY AUTO_INCREMENT,
	userId INT NOT NULL,
	filmId INT NOT NULL,
	roomId INT NOT NULL,
	dateBought DATETIME NOT NULL DEFAULT NOW(),
	dateFilm DATE NOT NULL,
	hourFilm TIME NOT NULL,
	quantity INT NOT NULL DEFAULT 1,
	individual_price DOUBLE NOT NULL,
	discount INT NOT NULL DEFAULT 0,
	FOREIGN KEY (userId) REFERENCES users(id),
	FOREIGN KEY (filmId) REFERENCES films(id),
	FOREIGN KEY (roomId) REFERENCES rooms(id)
);

CREATE TABLE IF NOT EXISTS reviews (
	id INT PRIMARY KEY AUTO_INCREMENT,
	userId INT NOT NULL,
	filmId INT NOT NULL,
	review_message VARCHAR(600) NOT NULL,
	score INT NOT NULL,
	reviewDateTime DATETIME NOT NULL DEFAULT NOW(),
	FOREIGN KEY (userId) REFERENCES users(id),
	FOREIGN KEY (filmId) REFERENCES films(id)
);